{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport api from '../utils/api';\nimport { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport useFlashMessage from './useFlashMessage';\nexport default function useAuth() {\n  _s();\n\n  const [authenticated, setAuthenticated] = useState(false);\n  const {\n    setFlashMessage\n  } = useFlashMessage();\n  const history = useHistory();\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n\n    if (token) {\n      api.defaults.headers.Authorization = `Bearer ${JSON.parse(token)}`;\n      setAuthenticated(true);\n    }\n  }, []);\n\n  async function register(formData) {\n    let msgText = 'Cadastro realizado com sucesso';\n    let msgType = 'success';\n\n    try {\n      const data = await api.post('/usuarios/cadastro', formData, {\n        'Content-Type': 'multipart/form-data'\n      }).then(response => {\n        return response.data;\n      });\n      await authUser(data);\n    } catch (error) {\n      msgText = error.response.data.message;\n      msgType = 'error';\n    }\n\n    setFlashMessage(msgText, msgType);\n  }\n\n  async function login(user) {\n    let msgText = 'Login realizado com sucesso';\n    let msgType = 'success';\n\n    try {\n      const data = await api.post('/usuarios/login', user).then(response => {\n        return response.data;\n      });\n      await authUser(data);\n    } catch (error) {\n      msgText = error.response.data.message;\n      msgType = 'error';\n    }\n\n    setFlashMessage(msgText, msgType);\n  }\n\n  async function authUser(data) {\n    setAuthenticated(true);\n    localStorage.setItem('token', JSON.stringify(data.token));\n    history.push('/user/profile');\n    setTimeout(() => {\n      window.location.reload();\n    }, 900);\n  }\n\n  function logout() {\n    const msgText = 'Logout realizado com sucesso';\n    const msgType = 'success';\n    setAuthenticated(false);\n    localStorage.removeItem('token');\n    api.defaults.headers.Authorization = undefined;\n    history.push('/');\n    setFlashMessage(msgText, msgType);\n  }\n\n  function deleteUser() {\n    const msgText = 'Conta excluída com sucesso';\n    const msgType = 'success';\n    setAuthenticated(false);\n    localStorage.removeItem('token');\n    api.defaults.headers.Authorization = undefined;\n    history.push('/');\n    setFlashMessage(msgText, msgType);\n  }\n\n  return {\n    authenticated,\n    register,\n    logout,\n    login,\n    deleteUser\n  };\n}\n\n_s(useAuth, \"wVPDpElFmvJHQhhU5x/ZMREcZwg=\", false, function () {\n  return [useFlashMessage, useHistory];\n});","map":{"version":3,"sources":["C:/Users/rapha/Desktop/Tech People/frontend/src/hooks/useAuth.js"],"names":["api","useState","useEffect","useHistory","useFlashMessage","useAuth","authenticated","setAuthenticated","setFlashMessage","history","token","localStorage","getItem","defaults","headers","Authorization","JSON","parse","register","formData","msgText","msgType","data","post","then","response","authUser","error","message","login","user","setItem","stringify","push","setTimeout","window","location","reload","logout","removeItem","undefined","deleteUser"],"mappings":"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","sourcesContent":["import api from '../utils/api'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { useHistory } from 'react-router-dom'\r\nimport useFlashMessage from './useFlashMessage'\r\n\r\nexport default function useAuth() {\r\n    const [authenticated, setAuthenticated] = useState(false)\r\n    const { setFlashMessage } = useFlashMessage()\r\n    const history = useHistory()\r\n\r\n    useEffect(() => {\r\n\r\n        const token = localStorage.getItem('token')\r\n\r\n        if(token) {\r\n            api.defaults.headers.Authorization = `Bearer ${JSON.parse(token)}`\r\n            setAuthenticated(true)\r\n        }\r\n    },[])\r\n\r\n    async function register(formData) {\r\n\r\n        let msgText = 'Cadastro realizado com sucesso'\r\n        let msgType = 'success'\r\n\r\n        try {\r\n            const data = await api.post('/usuarios/cadastro', formData, {\r\n                'Content-Type': 'multipart/form-data'\r\n            }).then((response) => {\r\n                return response.data\r\n            })\r\n\r\n            await authUser(data)\r\n        } catch(error) {\r\n            msgText = error.response.data.message\r\n            msgType = 'error'\r\n        }\r\n\r\n        setFlashMessage(msgText, msgType)\r\n    }\r\n\r\n    async function login(user) {\r\n        let msgText = 'Login realizado com sucesso'\r\n        let msgType = 'success'\r\n        \r\n        try {\r\n            const data = await api.post('/usuarios/login', user).then((response) => {\r\n                return response.data\r\n            })\r\n\r\n            await authUser(data)\r\n        } catch(error) {\r\n            msgText = error.response.data.message\r\n            msgType = 'error'\r\n\r\n        }\r\n\r\n        setFlashMessage(msgText, msgType)\r\n    }\r\n\r\n    async function authUser(data) {\r\n        setAuthenticated(true)\r\n\r\n        localStorage.setItem('token', JSON.stringify(data.token))\r\n\r\n        history.push('/user/profile')\r\n        setTimeout(() => {\r\n            window.location.reload()\r\n        },900)\r\n    }\r\n\r\n    function logout () {\r\n        const msgText = 'Logout realizado com sucesso'\r\n        const msgType = 'success'\r\n\r\n        setAuthenticated(false)\r\n        localStorage.removeItem('token')\r\n        api.defaults.headers.Authorization = undefined\r\n        history.push('/')\r\n\r\n        setFlashMessage(msgText, msgType)\r\n    }\r\n\r\n    function deleteUser () {\r\n        const msgText = 'Conta excluída com sucesso'\r\n        const msgType = 'success'\r\n\r\n        setAuthenticated(false)\r\n        localStorage.removeItem('token')\r\n        api.defaults.headers.Authorization = undefined\r\n        history.push('/')\r\n\r\n        setFlashMessage(msgText, msgType)\r\n    }\r\n\r\n    return { authenticated, register, logout, login, deleteUser }\r\n}"]},"metadata":{},"sourceType":"module"}